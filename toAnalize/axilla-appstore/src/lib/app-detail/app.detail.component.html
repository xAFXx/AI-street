<div class="kt-subheader kt-grid__item">
    <div class="kt-subheader__main">
        <h3 class="kt-subheader__title cursor-pointer" (click)="backToAppList()">
            <span>App Store</span>
        </h3>
        <span class="kt-subheader__separator kt-subheader__separator--v"></span>
        <span class="kt-subheader__desc" *ngIf="(app$ | async) as app">
            <h2>{{app.title}}</h2>
        </span>
    </div>
    <div class="kt-subheader__toolbar">
        <div class="kt-subheader__wrapper">
            <button type="submit"
                    class="btn btn-success"
                    (click)="openAddNewJob()">
                <i class="fa fa-plus"></i>
                <span>Schedule Job</span>
            </button>
            <button type="submit"
                    class="btn btn-success"
                    (click)="openUpdateDefinition()">
                <i class="fa fa-plus"></i>
                <span>Update Execute Definition</span>
            </button>
            <button *ngIf="AppStorePermissions.ManageAppPermission.ApiCallPermission.Create | permission"
                    type="submit"
                    class="btn btn-success"
                    (click)="addNewApiCall()">
                <i class="fa fa-plus"></i>
                <span>Add new appi call</span>
            </button>
            <button *ngIf="(showButtonCreateConnectionSettings | async) && (AppStorePermissions.ManageAppPermission.ApiCallPermission.Edit | permission)"
                    type="submit"
                    class="btn btn-success"
                    (click)="openAddConnectionSettings()">
                <i class="fa fa-plus"></i>
                <span>Connection Settings</span>
            </button>

            <button type="submit"
                    class="btn btn-success"
                    (click)="openNewChannel()"
                    [disabled]="ifDisabled">
                <i class="fa fa-plus"></i>
                <span>New Channel</span>
            </button>
        </div>
    </div>
</div>

<div class="kt-content" *ngIf="globalObject[0] && globalObject[0].actions && globalObject[0].actions.length > 0">
    <div class="kt-portlet">
        <div class="kt-portlet__body">
            <div class="processor-action-container d-flex">
                <ng-container *ngFor="let action of globalObject[0].actions">
                    <button class="btn btn-success"
                            (click)="startJob(action.properties)">
                        {{action.name  | localize}}
                    </button>
                </ng-container>
            </div>
        </div>
    </div>
</div>


<div class="kt-content">
    <div class="kt-portlet">
        <div class="kt-portlet__body">
            <p-accordion [multiple]="true">
                <p-accordionTab header="{{ 'Axilla.App.AppStore.App.Channel' | localize}}" [selected]="true">
                    <div class="primeng-datatable-container">
                        <p-table #dataTable
                                 (onLazyLoad)="getChannelDefinition($event)"
                                 [value]="channelDefinitions$ | async"
                                 [rows]="channelDefinitionTH.defaultRecordsCountPerPage"
                                 ScrollWidth="100%"
                                 [lazy]="true"
                                 [responsive]="primengTableHelper.isResponsive"
                                 [resizableColumns]="primengTableHelper.resizableColumns"
                                 selectionMode="single"
                                 [rowHover]="true">
                            <ng-template pTemplate="header">
                                <tr>
                                    <th style="width: 170px">Title</th>
                                    <th>Description</th>
                                    <th style="width:170px;text-align:center;"></th>
                                    <th style="width:200px;text-align:center;">Actions</th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-rowData>
                                <tr [pSelectableRow]="rowData">
                                    <td>
                                        <span class="image-text">{{rowData.title}}</span>
                                    </td>
                                    <td>
                                        <span class="image-text">{{rowData.description}}</span>
                                    </td>
                                    <td>
                                        <div class="row justify-content-center align-items-center">
                                            <div style="margin-right: 10px;">{{rowData.authenticationValid ? 'online': 'offline'}}</div>
                                            <div [ngClass]="{'online': rowData.authenticationValid, 'offline': !rowData.authenticationValid}"></div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="d-flex justify-content-around">
                                            <button class="btn" (click)="openDeleteChannelConfirmWindow(rowData.id)">
                                                <i class="fas fa-trash-alt"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </ng-template>
                        </p-table>
                        <div class="primeng-no-data" *ngIf="channelDefinitionTH.totalRecordsCount == 0">
                            <span translation="Axilla.NoData" source="Axilla"></span>
                        </div>
                        <div class="primeng-paging-container">
                            <p-paginator [rows]="channelDefinitionTH.defaultRecordsCountPerPage"
                                         #paginator
                                         (onPageChange)="getChannelDefinition($event)"
                                         [totalRecords]="channelDefinitionTH.totalRecordsCount"
                                         [rowsPerPageOptions]="channelDefinitionTH.predefinedRecordsCountPerPage"
                                         [showCurrentPageReport]="true"
                                         [currentPageReportTemplate]="'TotalRecordsCount' | localize:channelDefinitionTH.totalRecordsCount">
                            </p-paginator>
                        </div>
                    </div>
                </p-accordionTab>
                <ng-container *ngFor="let accordionItem of globalObject">
                    <p-accordion [multiple]="true">
                        <p-accordionTab header="{{accordionItem.name | localize}}" [selected]="true">
                            <ng-container *ngFor="let accordionTabItem of accordionItem.properties">
                                <div class="apps-custom form-group p-d-flex gap-2 mb-4 p-jc-start p-ai-center">
                                    <label for="defaultJournal" class="col-form-label">{{accordionTabItem.name | localize}}:</label>
                                    <div class="w-100">
                                        <app-update-field [fieldType]="accordionTabItem.type"
                                                          placeHolder="{{'Axilla.App.EnterYourText' | localize}}"
                                                          [value]="accordionTabItem.value"
                                                          [isRequired]=true
                                                          ValidateMessage="{{'Axilla.App.Required' | localize}}"
                                                          (updateFieldOutputValue)="onChangeUpdateFieldTextValue($event, accordionTabItem.name, accordionTabItem.channelId, accordionTabItem.useCache)"
                                                          [ngClass]="{'no-text-enterd': !isValid(accordionTabItem.name, accordionTabItem.required)}">
                                        </app-update-field>
                                    </div>
                                </div>
                            </ng-container>
                        </p-accordionTab>
                    </p-accordion>
                </ng-container>

                <ng-container *ngIf="(app$ | async) as app">
                    <p-accordion [multiple]="true">
                        <p-accordionTab header="{{'Axilla.App.AppStore.App.Settings' | localize}}" [selected]="true">
                            <ng-container *ngFor="let applicationProperty of app.applicationProperties">
                                <div class="apps-custom form-group p-d-flex gap-2 mb-4 p-jc-start p-ai-center">
                                    <label for="defaultJournal" class="col-form-label">
                                        {{applicationProperty.name | localize}}:
                                    </label>
                                    <div class="w-100">
                                        <app-update-field [fieldType]="applicationProperty.type"
                                                          placeHolder="{{'Axilla.App.AppStore.App.EnterYourText' | localize}}"
                                                          [value]="applicationProperty.defaultValue"
                                                          [isRequired]="applicationProperty.required"
                                                          ValidateMessage="{{'Axilla.App.AppStore.App.Required' | localize}}"
                                                          (updateFieldOutputValue)="onChangeUpdateFieldTextValue($event, applicationProperty.name, null, applicationProperty.useCache)"
                                                          [ngClass]="{'no-text-enterd': !isValidProperty(applicationProperty)}">
                                        </app-update-field>
                                    </div>
                                </div>
                            </ng-container>
                        </p-accordionTab>
                    </p-accordion>
                </ng-container>

                <p-accordionTab *ngIf="AppStorePermissions.ManageAppPermission.ApiCallPermission.View | permission"
                                header="{{ 'Axilla.App.AppStore.App.ApiCall' | localize}}">
                    <div class="row align-items-center">
                        <div class="primeng-datatable-container api-calls">
                            <p-table [value]="apiCalls$ | async"
                                     selectionMode="single"
                                     (onRowSelect)="onRowSelect($event)"
                                     [rowHover]="true"
                                    styleClass="p-datatable-striped"
                                    [paginator]="false"
                                    responsiveLayout="stack"
                                    [breakpoint]="'856px'">

                                <ng-template pTemplate="header">
                                    <tr>
                                        <th style="width: 150px">Title</th>
                                        <th>Call</th>
                                        <th style="width: 100px">Method</th>
                                        <th>Description</th>
                                        <th style="width: 150px">Application</th>
                                        <th style="width: 80px">Actions</th>
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="body" let-rowData>
                                    <tr [pSelectableRow]="rowData">
                                        <td>
                                            {{rowData.title}}
                                        </td>
                                        <td>
                                            <span class="truncated-5-line-text">{{rowData.call}}</span>
                                        </td>
                                        <td>
                                            {{rowData.method}}
                                        </td>
                                        <td>
                                            <span class="truncated-5-line-text">{{rowData.description}}</span>
                                        </td>
                                        <td>
                                            {{rowData.applicationName}}
                                        </td>
                                        <td>
                                            <ng-container *ngIf="rowData.accessGranted">
                                                <button class="btn" (click)="deleteApi(rowData.id)">
                                                    <i class="fa fa-trash-alt"></i>
                                                </button>
                                                <button class="btn" (click)="editApiCall(rowData.id)">
                                                    <i class="fa fa-pencil-alt"></i>
                                                </button>
                                            </ng-container>

                                            <ng-container *ngIf="!rowData.accessGranted">
                                                <button class="btn" (click)="editApiCall(rowData.id)">
                                                    <i class="fa fa-eye"></i>
                                                </button>
                                            </ng-container>

                                            <button class="btn" (click)="executeApi(rowData.id)">
                                                <i class="fa fa-play"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </ng-template>
                            </p-table>
                        </div>
                    </div>

                </p-accordionTab>
            </p-accordion>
            <!--<router-outlet></router-outlet>-->
            <div *ngIf="(app$ | async) as app">
                <div *ngIf="app.title=='PostNL'">
                    <app-postnl-details></app-postnl-details>
                </div>
            </div>
        </div>
        </div>

    <authDeterminationModal #authDeterminationModal (modalSave)="getOauthLogin($event)"></authDeterminationModal>

</div>
