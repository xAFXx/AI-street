<div class="row align-items-center position-relative">
    <div class="col primeng-datatable-container">
        <p-table #dataTable
                 [value]="primengTableHelper.records"
                 (onLazyLoad)="onPageChange($event)"
                 [columns]="cols"
                 [rows]="primengTableHelper.defaultRecordsCountPerPage"
                 [scrollable]="true"
                 [paginator]="false">

            <ng-template pTemplate="header" let-columns>
                <tr>
                    <th style="width: 150px"
                        pSortableColumn="Key">

                        <span translation="Axilla.VDB.DatabaseKey">{{'Key' | localize}}</span>
                        <p-sortIcon field="Key"></p-sortIcon>
                    </th>

                    <ng-container *ngIf="!isColumnSelected; else columnsHeader">
                        <th></th>
                    </ng-container>

                    <ng-template #columnsHeader>
                        <ng-container *ngFor="let col of columns">
                            <th *ngIf="!col.sorting"
                                [style.width]="col.width ? col.width : 'auto'">
                                <span translation="{{col.header}}" source="Axilla"></span>
                            </th>

                            <th *ngIf="col.sorting"
                                [style.width]="col.width ? col.width : 'auto'" pSortableColumn="{{col.field}}">
                                <span translation="{{col.header}}" source="Axilla"></span>
                                <p-sortIcon field="{{col.field}}"></p-sortIcon>
                            </th>
                        </ng-container>
                    </ng-template>

                    <ng-container *ngIf="isCustomActionsAvailable; else actions">
                        <th style="width: 330px">
                            <span>{{'Action' | localize}}</span>
                        </th>
                    </ng-container>

                    <ng-template #actions>
                        <th style="width: 130px">
                            <span>{{'Action' | localize}}</span>
                        </th>
                    </ng-template>
                </tr>
                <tr [formGroup]="searchForm">
                    <td style="width: 150px">
                        <input name="key"
                               formControlName="key"
                               class="form-control kt-input"
                               [placeholder]="l('SearchWithThreeDot')"
                               type="text">
                    </td>
                    <ng-container *ngIf="fullTextSearch">
                        <ng-container *ngFor="let col of columns">
                            <td>
                                <input name="{{col.field}}"
                                       formControlName="{{col.field}}"
                                       class="form-control kt-input"
                                       (ngModelChange)="onPageChange()"
                                       [placeholder]="l('SearchWithThreeDot')"
                                       type="text">
                            </td>
                        </ng-container>
                    </ng-container>

                    <ng-container *ngIf="showSearch()">
                        <td [attr.colspan]="columnCount">
                            <input name="fullText"
                                   formControlName="fullText"
                                   class="form-control kt-input"
                                   [placeholder]="l('SearchWithThreeDot')"
                                   (ngModelChange)="onPageChange()"
                                   type="text">
                        </td>
                    </ng-container>
                    <td></td>
                </tr>
            </ng-template>

            <ng-template pTemplate="body" let-rowData let-columns="columns" let-index="rowIndex">
                <ng-container *ngIf="openedItem === rowData['Key']">
                    <tr>
                        <td>
                            {{rowData['Key']}}
                        </td>

                        <td [attr.colspan]="columnCount">
                            <div>
                                <app-vdb-details-editor [vdbName]="vdbName"
                                                        [openedItem]="openedItem"
                                                        [openedValue]="openedValue"
                                                        [mode]="mode"
                                                        (closeRow)="closeItem()"
                                                        (saveRow)="changeItem($event)"
                                                        (changeMode)="setNewMode($event)"></app-vdb-details-editor>
                            </div>
                        </td>
                    </tr>
                </ng-container>

                <ng-container *ngIf="openedItem !== rowData['Key']">
                    <tr>
                        <td (click)="openItem($event, rowData)">
                            {{rowData['Key']}}
                        </td>

                        <ng-container *ngIf="!isColumnSelected; else columnData">
                            <td (click)="openItem($event, rowData)"></td>
                        </ng-container>

                        <ng-template #columnData>
                            <td *ngFor="let col of columns" (click)="openItem($event, rowData)" style="min-width: 150px; max-width: 400px">
                                <ng-container [ngSwitch]="col.type">
                                    <div *ngSwitchCase="3">
                                        {{rowData[col.field] | dayjsFormat:'dd-MM-YYYY'}}
                                    </div>
                                    <div *ngSwitchCase="4">
                                        {{rowData[col.field] | dayjsFormat:'DD-mm-yyyy, HH:mm'}}
                                    </div>
                                    <div *ngSwitchCase="10">
                                        <app-image-container [articleId]="rowData[col.field]" [height]="col.height"></app-image-container>
                                    </div>
                                    <div *ngSwitchDefault class="value-overflown">
                                        {{rowData[col.field]}}
                                    </div>
                                </ng-container>
                            </td>
                        </ng-template>


                        <td [ngStyle]="{'width.px': actionWidth }">
                            <div class="d-flex align-items-center justify-content-between">

                                <ng-container *ngIf="isCustomActionsAvailable">
                                    <app-vdb-custom-actions [vdbItem]="rowData" (onApplyAction)="onPageChange()"></app-vdb-custom-actions>
                                </ng-container>

                                <button type="button"
                                        class="btn"
                                        style="height: calc(1.5em + 1.3rem + 2px);"
                                        (click)="deleteByKeyFromVDB(rowData.key)">
                                    <i class="fa fa-trash-alt"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                </ng-container>

            </ng-template>
        </p-table>
        <div class="primeng-no-data" *ngIf="primengTableHelper.totalRecordsCount === 0">
            <span translation="NoData"></span>
        </div>
        <div class="primeng-paging-container">
            <p-paginator [rows]="primengTableHelper.defaultRecordsCountPerPage"
                         #paginator
                         (onPageChange)="onPageChange($event)"
                         [totalRecords]="primengTableHelper.totalRecordsCount"
                         [rowsPerPageOptions]="primengTableHelper.predefinedRecordsCountPerPage">
            </p-paginator>
            <span class="total-records-count">
                {{'TotalRecordsCount' | localize:primengTableHelper.totalRecordsCount}}
            </span>
        </div>
        <div class="spinner-container" *ngIf="primengTableHelper.isLoading">
            <p-progressSpinner></p-progressSpinner>
        </div>
    </div>
</div>
